@model eGoatDDD.Application.Goats.Models.GoatDto
@using eGoatDDD.Application.Breeds.Models
@using eGoatDDD.Application.Colors.Models


@{
    ViewData["Title"] = "Create";
}

<h2>Create</h2>
<hr />
<form asp-action="Create">
    <div class="row">

        <div class="col col-lg-4 col-md-4 col-sm-6 col-xs-12">

            <div asp-validation-summary="All" class="text-danger"></div>
            <div class="form-group">
                <h4>Color</h4>
                <select class="form-control" data-val-required="The field is required." data-val="true" name="ColorId" id="ColorId">
                    <option value="0" selected="selected">
                        Please select the color
                    </option>
                    @foreach (ColorDto item in (List<ColorDto>)ViewData["Colors"])
                    {
                        <option value="@item.Id"> @item.Name</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <h4>Breed</h4>
                <select class="form-control" data-val-required="The field is required." data-val="true" name="BreedId" id="BreedId">
                    <option value="0" selected="selected">
                        Please select the Breed
                    </option>
                    @foreach (BreedDto item in (List<BreedDto>)ViewData["Breeds"])
                    {
                        <option value="@item.Id"> @item.Name</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <h4>Details</h4>
                <div class="form-group">
                    <input asp-for="Code" required type="number" class="form-control" placeholder="Code" />
                    <span asp-validation-for="Code" class="text-danger"></span>
                </div>
                <div class="form-group hidden">
                    <input asp-for="Picture" required class="form-control" placeholder="Picture" id="Picture" />
                    <span asp-validation-for="Picture" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <div class='input-group'>
                        <input asp-for="BirthDate" id='birthdate' class="form-control" />
                        <span asp-validation-for="BirthDate" class="text-danger"></span>
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <div class='input-group'>
                        <input asp-for="SlaughterDate" id='slaughterdate' class="form-control" />
                        <span asp-validation-for="SlaughterDate" class="text-danger"></span>
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>


        </div>
        <div class="col col-lg-4 col-md-4 col-sm-6 col-xs-12 goatImageWrapper">
            <span class="wrapper">
                <input type="file" id="goatImage" data-action="/api/image" />
            </span>
        </div>
    </div>
    <div class="row">
        <div class="col col-lg-4 col-md-4 col-sm-6 col-xs-12">
            <div class="form-group">
                <input type="submit" value="Create" name="Save" class="btn btn-default" />
                <input type="submit" value="Save and Broadcast" name="Save" class="btn btn-default" />
            </div>
        </div>
    </div>

</form>
@*
    TODO://multiple images per gaots
        https://tutorialzine.com/2013/05/mini-ajax-file-upload-form
*@

@section scripts{
    <script type="text/javascript">
        (function ($) {

            $(document).ready(function () {

                $('#goatImage').on('change', function (event) {
                    event.preventDefault();

                    var $file = $("#goatImage")[0].files[0];

                    var $action = $("#goatImage").data("action");

                    var $formdata = new FormData();

                    $formdata.append("file", $file);

                    $.ajax({
                        type: "POST",
                        url: $action,
                        data: $formdata, // serializes the form's elements.
                        processData: false,
                        contentType: false
                    }).done(function (result) {
                        $("#Picture").val(result);
                        console.log(result);
                        $(".goatImageWrapper .wrapper").html(result);
                    });

                    return false; // avoid to execute the actual submit of the form.
                });
            });
        })(jQuery);
    </script>
}

